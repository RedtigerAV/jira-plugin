<ng-container
  *ngIf="{
    options: dataSource.data$ | async
  } as data"
>
  <mat-form-field [formGroup]="controlContainer.control" appearance="outline">
    <mat-label>{{ label }}</mat-label>

    <mat-select
      [placeholder]="placeholder"
      [formControl]="control"
      (selectionChange)="onSelectionChange($event)"
    >
      <ng-container *ngIf="getOptions(data.options)?.length; else notFound">
        <ng-container *ngFor="let option of getOptions(data.options)">
          <mat-option [value]="dataSource.getValue(option)" class="format-text">
            <ng-container
              *ngTemplateOutlet="
          !!optionDirective ? optionDirective.templateRef : defaultOption;
          context: { $implicit: option }
        "
            ></ng-container>
          </mat-option>

          <ng-template #defaultOption let-option>
            {{ dataSource.displayWith(option) }}
          </ng-template>
        </ng-container>
      </ng-container>

      <ng-template #notFound>
        <mat-option disabled>
          {{ textNotFound }}
        </mat-option>
      </ng-template>
    </mat-select>

    <mat-error *ngIf="getErrorMessage()">
      {{ getErrorMessage() }}
    </mat-error>
  </mat-form-field>
</ng-container>
